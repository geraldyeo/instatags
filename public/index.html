<!DOCTYPE html>
<!--[if lt IE 7 ]>
<html lang="en" class="ie6"> <![endif]-->
<!--[if IE 7 ]>
<html lang="en" class="ie7"> <![endif]-->
<!--[if IE 8 ]>
<html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9 ]>
<html lang="en" class="ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html lang="en"> <!--<![endif]-->
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>mementogram</title>
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">

    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="js/sliderjs/slider.min.css" rel="stylesheet" type="text/css"/>
    <link href="css/styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>

<div class="root">
    <header>

    </header>

    <div role="main">
        <div class="media-inner">
            <div class="media-photos"></div>
            <div class="media-info">
                <section class="media-user">
                    <h2></h2>
                    <span class="img img-inset user-avatar"></span>
                </section>
                <section class="media-likes">
                    <h2><span class="like-count"></span></h2>
                    <span class="img img-inset heart"></span>
                </section>
            </div>
        </div>
    </div>

    <footer>
        <div class="wrapper">
            <p class="copyright">Â© 2012 primetwentythree</p>
        </div>
    </footer>
</div>

<script src="/socket.io/socket.io.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
<script src="js/sliderjs/slider.js"></script>
<script>
    (function ($) {
        var slider = new Slider($('.media-photos'));
        slider.setSize(612, 612)
                .setTheme('memento')
                .setDuration(5000)
                .setTransitionDuration(1000)
                .setTransitionFunction(SliderTransitionFunctions.squares);

        // listen to changed...
        var onChanged = function (e, node) {
            var data = node.data();
            $('.media-user h2').html(data.fullname);
            $('.media-user .user-avatar').css('background-image', 'url(' + data.profilepicture + ')');
            $('.media-likes .like-count').html(data.likecount);
        };
        $('.media-photos').on('changed', onChanged);

        var socket = io.connect('http://instawed.jit.su/');
        socket.on('photo', function (raw) {
            var medias = JSON.parse(raw);
            var photos = [];

            $.map(medias, function (media) {
                photos.push({
                                "link"          :media.link,
                                "src"           :media.images.standard_resolution.url,
                                "username"      :media.user.username,
                                "fullname"      :media.user.full_name,
                                "profilepicture":media.user.profile_picture,
                                "likecount"     :media.likes.count
                            });
            });

            console.log('updated...');
            slider.setPhotos(photos);
        });
    })(jQuery);
</script>
</body>
</html>